---
title: "Reproducible Data Analysis Project"
author: "Louise Drysdale"
date: "08/05/2022"
output:
  html_document:
    df_print: paged
  prettydoc::html_pretty:
    theme: tactile
    highlight: github
    math: kaytex
  pdf_document: default
subtitle: Selection of Chicago Bulls Starting Five 2019/2020 Season
bibliography: references\references.bib.txt
editor_options:
  chunk_output_type: inline
---

# Introduction

[](images\Chicago_Bulls_logo.svg.png)

The purpose of this report is to analyse player and team data from the 2018/ 2019 NBA competition to determine the best starting player line up for the Chicago Bulls to purchase for the 2019/2020 season. Player effectiveness and budget are to be considered. The parameters identified are: 
#### Total team budget : $118 000 000
#### Line up of interest: Starting line up
#### Assumed final roster number: 15 players
#### Data Sources: basketballstats.com
#### Soundtrack during analysis: [Getcha Head in the Game](https://www.youtube.com/watch?v=G--VfuI0fNs)

#### Required packages 

For this project, the packages "tidyverse"[@1], "broom"[@2], "ggplot2"[@3], "AdvancedBasketballStats" [@4], "rmarkdown"[@5] and "knitr"[@6] as well as the "prettydoc" [@7] theme were used.

```{r load rmarkdown, echo=TRUE}
library(rmarkdown)
```

```{r load knitr, echo=TRUE}
library(knitr)
```


```{r load tidyverse, echo=TRUE}
library(tidyverse)
```
```{r read in broom, echo=TRUE}
library(broom)
```
```{r read in ggplot2, echo=TRUE}
library(ggplot2)
```

```{r read in basketball stats package, echo=TRUE}
library(AdvancedBasketballStats)
```

### Required Data for this analysis: 
```{r read in data, echo=TRUE}
Pstat1819 <- read.csv("data/raw/2018-19_nba_player-statistics.csv")
T1stat1819 <- read.csv("data/raw/2018-19_nba_team-statistics_1.csv")
T2stat1819 <- read.csv("data/raw/2018-19_nba_team-statistics_2.csv")
Psal1819 <- read.csv("data/raw/2018-19_nba_player-salaries.csv")
Tpay1920 <- read.csv("data/raw/2019-20_nba_team-payroll.csv")
```

### Step 1: Checking data structure

Links to a list of variable abbreviations can be found here:
[link](README.md.txt) [@4]

Before analysis commenced, the data was checked for its structure, variable types and any missing data.
a) Checking Player Statistics 2018/2019 from basketball-reference.com
```{r checking Player Stats data, echo=TRUE}
str(Pstat1819)
knitr::kable(head(Pstat1819))
knitr::kable(tail(Pstat1819))
```
Player Position and Team name are both string/character variables, but for further analysis, these will need to be recognised as factor (categorical) variables

```{r string to factor, echo=TRUE}
Pstat1819 <- transform(Pstat1819, Pos = as.factor(Pos), Tm = as.factor(Tm))
```

There are also some missing values in the player statistics data:
```{r missing data players, include=FALSE}
(is.na(Pstat1819))
```

The missing data are not in factor or string columns, so they can be revalued as "0". We don't want to eliminate these player rows just yet, because there could be other valuable player stats to consider
```{r column names with NA, echo=TRUE}
colnames(Pstat1819)[colSums(is.na(Pstat1819)) > 0]
Pstat1819[is.na(Pstat1819)] = 0
```


b) Checking Team Statistics 1 2018/2019 from basketball-reference.com
```{r checking Team Stats 1 data, echo=TRUE}
(T1stat1819)
knitr::kable(head(T1stat1819))
knitr::kable(tail(T1stat1819))
which(is.na(T1stat1819))
```
Variables are appropriate, but there are three additional columns that may create issues in further analysis with missing data, so these are removed. 

```{r remove NA columns, echo=TRUE}
colnames(T1stat1819)[colSums(is.na(T1stat1819)) > 0]
T1stat1819 <- select(T1stat1819, -c(X, X.1, X.2))
```


c) Checking Team Statistics 2 2018/2019 from basketball-reference.com
```{r checking Team Stats 2 data, echo=TRUE}
str(T2stat1819)
knitr::kable(head(T2stat1819))
knitr::kable(tail(T2stat1819))
which(is.na(T2stat1819))
```
Variables are appropriate, no missing data

d) Checking Player Salaries from hoopshype.com/salaries
```{r checking player salary data, echo=TRUE}
str(Psal1819)
knitr::kable(head(Psal1819))
knitr::kable(tail(Psal1819))
which(is.na(Psal1819))
```
Variables are appropriate, no missing data.


### Step 2: Retiring Players

Unfortunately, there are a few players retiring at the end of the 2018/2019 NBA season, so they won't be available for the roster. They are Channing Frye, Dwyane Wade, Dirk Nowitzki, Tony Parker, Darren Collison (he will return again, but not this season), Zaza Pachulia, Shaun Livingston, Luol Deng, Jose Calderon, Marcin Gortat and Jon Leuer [@8]. These players have been excluded from analysis.

```{r retired list, echo=TRUE}
retired <- c("Channing Frye", "Dwyane Wade", "Dirk Nowitzki", "Tony Parker", "Darren Collison", "Zaza Pachulia", "Shaun Livingston", "Luol Deng", "Jose Calderon", "Marcin Gortat", "Jon Leuer")
Pstat1819 <- Pstat1819 %>% filter(!player_name %in% retired)
```

### Step 3: Player duplicates

Some players were traded between teams during the 2018/2019 season. So that a player's whole season stats can be assessed, duplicates that show their incomplete stats are removed and their total records kept, where their team name is logged as "TOT". This is done by "slicing" to keep only the entry showing the players maximum points scored (across all games played for all teams).

```{r playerstatsmax, echo=TRUE}
Pstat1819max <- Pstat1819 %>% group_by(player_name) %>% slice(which.max(PTS))
str(Pstat1819max)
```


### Step 4: Matching Salaries to Players

It now appears that there are 519 players to consider in the "Pstat1819max" data frame, whereas 576 player salaries are available. Salaries will now be mathed to the players remaining for consideration and confirm we have data and salary benchmarks for all players we will consider.

```{r missing salaries, echo=TRUE}
Pstat1819max <- Pstat1819max %>% left_join(Psal1819, by = "player_name")
which(is.na(Pstat1819max))
colnames(Pstat1819max)[colSums(is.na(Pstat1819max)) > 0]
Pstat1819max <- Pstat1819max %>% filter(!is.na(salary))
```

### Step 5: Deciding Metrics of Interest

The player statistics provided appear to be largely offensive statistics, rather than defensive statistics [@4], so this will be the focus of the analysis. Unlike other team sports, all players have an important role in offensive play, so it would be unwise to select a player based solely on defensive capabilities [@9]. 

There are a few key metrics of interest in the given data. These include effective field goal percentage (EFG%) [@10], assists, rebounds, three pointers and assists to turnovers ratio [@9@11]. Unfortunately it isn't possible to know how many wins and losses were had by each individual player through the season, as many players were traded through the season and it isn't known at what time point that occurred with the given data. This would be valuable information, as then a win/loss percentage could be associated to relevant metrics for each player[@11]. 

Instead, each of these metrics will be compared at a team level, to determine the importance of each metric to game wins within the competition. This will then allow for focus on selection of players who perform well in areas associated with winning. Although independence of observations is assumed here (teams are not being compared year to year) it should be recognised that some players may have been traded and contributed to the success of more than one team.

Here the two sets of team data are joined and a new variable assists to turnovers ratio is calculated:
```{r team assist to turnovers join team data, echo=TRUE}
T2stat1819 <- T2stat1819 %>% mutate(AST_TOV = AST / TOV)
T3stat1819 <- T2stat1819 %>% left_join(T1stat1819, by = "Team")
```

#### EFG% to Wins by Team

```{r efg wins team ggplot, echo=TRUE}
efgwin <- ggplot(T3stat1819, aes(x = eFG., y = W )) + geom_point(colour = "#850c20") + geom_smooth(method = "lm", colour = "#0c8571") + labs(title = "Relationship Team Wins to Team EFG% 2018/2019", caption = "Data source: basketball-reference.com", x = "Team EFG%", y = "Number Wins") + geom_text(aes(label = Team))
efgwin
```

Graphically, there is a positive relationship between number of wins and effective field goal percentage at a team level. This graph also suggests the Bulls might need to improve this metric to advance on the ladder. Some assumptions about this model will need to be checked prior to proceeding. 

```{r lm efgwin, echo=TRUE}
efgwinlm <- lm(W ~ eFG., data = T3stat1819)
summary(efgwinlm)
tidy(efgwinlm, conf.int = TRUE)
```

Checking assumptions of model, there is one outlier (The Golden State Warriors) that could be removed to understand the relationship between winning and effective goal percentage.
```{r checking assumptions efgwinlm, echo=TRUE}
std_res <- rstandard(efgwinlm)
points <- 1:length(std_res)
sdplot <- ggplot(data = NULL, aes(x = points, y = std_res)) + geom_point() + ylim(c(-4,4)) + geom_hline(yintercept = c(-3,3), colour = "red", linetype = "dashed")
sdplot
hats <- hatvalues(efgwinlm)
hat_labels <- if_else(hats >= 0.15, paste(points),"")
hatplot <- ggplot(data = NULL, aes(x = points, y = hats)) + geom_point() + geom_text(aes(label = hat_labels), nudge_y = 0.005)
hatplot
cook <- cooks.distance(efgwinlm)
cook_labels <- if_else(cook >= 0.2, paste(points),"")
cookplot <- ggplot(data = NULL, aes(x = points, y = cook)) + geom_point() + geom_text(aes(label = cook_labels), nudge_y = 0.005)
cookplot
```

```{r lm efgwin2, echo=TRUE}
T3stat <- T3stat1819 %>% filter(Team != "Golden State Warriors")
efgwin2lm <- lm(W ~ eFG., data = T3stat)
summary(efgwin2lm)
tidy(efgwin2lm, conf.int = TRUE)
```
```{r checking assumptions efgwin2lm, echo=TRUE}
std_res <- rstandard(efgwin2lm)
points <- 1:length(std_res)
sdplot <- ggplot(data = NULL, aes(x = points, y = std_res)) + geom_point() + ylim(c(-4,4)) + geom_hline(yintercept = c(-3,3), colour = "red", linetype = "dashed")
sdplot
hats <- hatvalues(efgwin2lm)
hat_labels <- if_else(hats >= 0.15, paste(points),"")
hatplot <- ggplot(data = NULL, aes(x = points, y = hats)) + geom_point() + geom_text(aes(label = hat_labels), nudge_y = 0.005)
hatplot
cook <- cooks.distance(efgwin2lm)
cook_labels <- if_else(cook >= 0.2, paste(points),"")
cookplot <- ggplot(data = NULL, aes(x = points, y = cook)) + geom_point() + geom_text(aes(label = cook_labels), nudge_y = 0.005)
cookplot
```
```{r ggplot efgwin2, echo=TRUE}
efgwin2 <- ggplot(T3stat, aes(x = eFG., y = W )) + geom_point(colour = "#850c20") + geom_smooth(method = "lm", colour = "#0c8571") + labs(title = "Relationship Team Wins to Team EFG% 2018/2019", subtitle = "Outlier omitted", caption = "Data source: basketball-reference.com", x = "Team EFG%", y = "Number Wins") + geom_text(aes(label = Team))
efgwin2
```

After re-checking the model that describes the relationship between effective goal percentage and wins without the Golden State Warriors, it can be verified that team effective field goal percentage required to achieve a top 3 ladder ranking will need to be at least 55%.

#### Three Pointers to Wins by Team

The association between number of three pointers for a team and number of wins is not as strong (in terms of correlation co-efficient and confidence intervals).

```{r three pointers wins team, echo=TRUE}
x3pwin <- ggplot(T3stat1819, aes(x = X3P, y = W )) + geom_point(colour = "#850c20") + geom_smooth(method = "lm", colour = "#340c85") + labs(title = "Relationship Team Wins to Team Three Pointers 2018/2019", caption = "Data source: basketball-reference.com", x = "Team Three Pointers", y = "Number Wins") + geom_text(aes(label = Team))
x3pwin
```

```{r lm x3pwin, echo=TRUE}
x3pwinlm <- lm(W ~ X3P, data = T3stat1819)
summary(x3pwinlm)
tidy(x3pwinlm, conf.int = TRUE)
```
```{r checking assumptions x3pwinlm, echo=TRUE}
std_res <- rstandard(x3pwinlm)
points <- 1:length(std_res)
sdplot <- ggplot(data = NULL, aes(x = points, y = std_res)) + geom_point() + ylim(c(-4,4)) + geom_hline(yintercept = c(-3,3), colour = "red", linetype = "dashed")
sdplot
hats <- hatvalues(x3pwinlm)
hat_labels <- if_else(hats >= 0.15, paste(points),"")
hatplot <- ggplot(data = NULL, aes(x = points, y = hats)) + geom_point() + geom_text(aes(label = hat_labels), nudge_y = 0.005)
hatplot
cook <- cooks.distance(x3pwinlm)
cook_labels <- if_else(cook >= 0.125, paste(points),"")
cookplot <- ggplot(data = NULL, aes(x = points, y = cook)) + geom_point() + geom_text(aes(label = cook_labels), nudge_y = 0.005)
cookplot
```
It appears the Houston Rockets and Washington Wizards are potential outliers. The model will need to be re-tested without their data. 

```{r lm x3pwin2, echo=TRUE}
T3statt <- T3stat1819 %>% filter(Team != "Washington Wizards" & Team != "Houston Rockets")
x3pwin2lm <- lm(W ~ X3P, data = T3statt)
summary(x3pwin2lm)
tidy(x3pwin2lm, conf.int = TRUE)
```

```{r checking assumptions x3pwin2lm, echo=TRUE}
std_res <- rstandard(x3pwin2lm)
points <- 1:length(std_res)
sdplot <- ggplot(data = NULL, aes(x = points, y = std_res)) + geom_point() + ylim(c(-4,4)) + geom_hline(yintercept = c(-3,3), colour = "red", linetype = "dashed")
sdplot
hats <- hatvalues(x3pwin2lm)
hat_labels <- if_else(hats >= 0.15, paste(points),"")
hatplot <- ggplot(data = NULL, aes(x = points, y = hats)) + geom_point() + geom_text(aes(label = hat_labels), nudge_y = 0.005)
hatplot
cook <- cooks.distance(x3pwin2lm)
cook_labels <- if_else(cook >= 0.125, paste(points),"")
cookplot <- ggplot(data = NULL, aes(x = points, y = cook)) + geom_point() + geom_text(aes(label = cook_labels), nudge_y = 0.005)
cookplot
```
```{r three pointers wins team2, echo=TRUE}
x3pwin2 <- ggplot(T3statt, aes(x = X3P, y = W )) + geom_point(colour = "#850c20") + geom_smooth(method = "lm", colour = "#340c85") + labs(title = "Relationship Team Wins to Team Three Pointers 2018/2019", subtitle = "Outliers omitted", caption = "Data source: basketball-reference.com", x = "Team Three Pointers", y = "Number Wins") + geom_text(aes(label = Team))
x3pwin2
```

Removing outliers did not make a large difference to the relationship observed between number of three pointers and team wins, or the reliability of the model in terms of confidence intervals. However, Chicago Bulls had a comparably very low number of three pointers, so it would be worth choosing players who could improve this metric. Effective field goal percentage does take into account three pointers, however for players on the perimeter, such as the point guard and shooting guard, their effective field goal percentages might not be as high due to their position on the perimeter on the court[@9@12] meaning they may not score as many two pointers to contribute to this statistic. For these positions, players should also have a high capacity to score three pointers, even if their effective field goal percentage is lower. This will be investigated further along.

#### Assists to Wins by Team

```{r assists wins team, echo=TRUE}
astwin <- ggplot(T3stat1819, aes(x = AST, y = W )) + geom_point(colour = "#0c8571") + geom_smooth(method = "lm", colour = "#340c85") + labs(title = "Relationship Team Wins to Team Assists 2018/2019", caption = "Data source: basketball-reference.com", x = "Team Assists", y = "Number Wins") + geom_text(aes(label = Team))
astwin
```
There appears to be a positive relationship between number of assists for each team and wins, but it is not a particularly large correlation co-efficient and the confidence interval is also not reliable.

```{r lm astwin, echo=TRUE}
astwinlm <- lm(W ~ AST, data = T3stat1819)
summary(astwinlm)
tidy(astwinlm, conf.int = TRUE)
```
```{r checking assumptions astwinlm, echo=TRUE}
std_res <- rstandard(astwinlm)
points <- 1:length(std_res)
sdplot <- ggplot(data = NULL, aes(x = points, y = std_res)) + geom_point() + ylim(c(-4,4)) + geom_hline(yintercept = c(-3,3), colour = "red", linetype = "dashed")
sdplot
hats <- hatvalues(astwinlm)
hat_labels <- if_else(hats >= 0.15, paste(points),"")
hatplot <- ggplot(data = NULL, aes(x = points, y = hats)) + geom_point() + geom_text(aes(label = hat_labels), nudge_y = 0.005)
hatplot
cook <- cooks.distance(astwinlm)
cook_labels <- if_else(cook >= 0.2, paste(points),"")
cookplot <- ggplot(data = NULL, aes(x = points, y = cook)) + geom_point() + geom_text(aes(label = cook_labels), nudge_y = 0.005)
cookplot
```
Because this model is not particularly robust, ratio of assists to turnovers will be considered instead (Kingaroy REF)

#### Assists/Turnovers Ratio to Wins by Team

```{r assists turnovers wins team, echo=TRUE}
asttowin <- ggplot(T3stat1819, aes(x = AST_TOV, y = W )) + geom_point(colour = "#0c8571") + geom_smooth(method = "lm", colour = "#850c20") + labs(title = "Relationship Team Wins to Team Assists/Turnovers Ratio 2018/2019", caption = "Data source: basketball-reference.com", x = "Team Assist to Turnovers Ratio", y = "Number Wins") + geom_text(aes(label = Team))
asttowin
```
```{r lm asttowin, echo=TRUE}
asttowinlm <- lm(W ~ AST_TOV, data = T3stat1819)
summary(asttowinlm)
tidy(asttowinlm, conf.int = TRUE)
```
```{r checking assumptions asttowinlm, echo=TRUE}
std_res <- rstandard(asttowinlm)
points <- 1:length(std_res)
sdplot <- ggplot(data = NULL, aes(x = points, y = std_res)) + geom_point() + ylim(c(-4,4)) + geom_hline(yintercept = c(-3,3), colour = "red", linetype = "dashed")
sdplot
hats <- hatvalues(asttowinlm)
hat_labels <- if_else(hats >= 0.15, paste(points),"")
hatplot <- ggplot(data = NULL, aes(x = points, y = hats)) + geom_point() + geom_text(aes(label = hat_labels), nudge_y = 0.005)
hatplot
cook <- cooks.distance(asttowinlm)
cook_labels <- if_else(cook >= 0.2, paste(points),"")
cookplot <- ggplot(data = NULL, aes(x = points, y = cook)) + geom_point() + geom_text(aes(label = cook_labels), nudge_y = 0.005)
cookplot
```
This model of the relationship between assist/turnover ratio to wins looks more robust than the assists to wins model, so assists to turnovers ratio will be considered when selecting players for the position of point guard (Kingaroy).

#### Rebounds to Wins by Team

```{r rebwin ggplot, echo=TRUE}
rebwin <- ggplot(T3stat1819, aes(x = TRB, y = W )) + geom_point(colour = "#340c85") + geom_smooth(method = "lm", colour = "#850c20") + labs(title = "Relationship Team Wins to Rebounds 2018/2019", caption = "Data source: basketball-reference.com", x = "Total Rebounds", y = "Number Wins") + geom_text(aes(label = Team))
rebwin
```

This plot also shows the Milwaukee Bucks have a very high number of rebounds and finished at the top of their ladder. This could be their competitive edge.

```{r lm rbwin, echo=TRUE}
rbwinlm <- lm(W ~ TRB, data = T3stat1819)
summary(rbwinlm)
tidy(rbwinlm, conf.int = TRUE)
```
```{r checking assumptions rbwinlm, echo=TRUE}
std_res <- rstandard(rbwinlm)
points <- 1:length(std_res)
sdplot <- ggplot(data = NULL, aes(x = points, y = std_res)) + geom_point() + ylim(c(-4,4)) + geom_hline(yintercept = c(-3,3), colour = "red", linetype = "dashed")
sdplot
hats <- hatvalues(rbwinlm)
hat_labels <- if_else(hats >= 0.15, paste(points),"")
hatplot <- ggplot(data = NULL, aes(x = points, y = hats)) + geom_point() + geom_text(aes(label = hat_labels), nudge_y = 0.005)
hatplot
cook <- cooks.distance(rbwinlm)
cook_labels <- if_else(cook >= 0.2, paste(points),"")
cookplot <- ggplot(data = NULL, aes(x = points, y = cook)) + geom_point() + geom_text(aes(label = cook_labels), nudge_y = 0.005)
cookplot
```
There appear to be three outliers: Milwuakee Bucks, Houston Rockets and Phoenix Suns. However, the Houston Rockets point appears to be more of an influential point than those of Milwuakee and Phoenix. The analysis will be repeated to check model assumptions without Houston.

```{r lm rbwin2, echo=TRUE}
T3stattt <- T3stat1819 %>% filter(Team != "Houston Rockets")
rbwin2lm <- lm(W ~ TRB, data = T3stattt)
summary(rbwin2lm)
tidy(rbwin2lm, conf.int = TRUE)
```

```{r rechecking assumptions rbwin2lm }

std_res <- rstandard(rbwin2lm)
points <- 1:length(std_res)
sdplot <- ggplot(data = NULL, aes(x = points, y = std_res)) + geom_point() + ylim(c(-4,4)) + geom_hline(yintercept = c(-3,3), colour = "red", linetype = "dashed")
sdplot
hats <- hatvalues(rbwin2lm)
hat_labels <- if_else(hats >= 0.15, paste(points),"")
hatplot <- ggplot(data = NULL, aes(x = points, y = hats)) + geom_point() + geom_text(aes(label = hat_labels), nudge_y = 0.005)
hatplot
cook <- cooks.distance(rbwin2lm)
cook_labels <- if_else(cook >= 0.2, paste(points),"")
cookplot <- ggplot(data = NULL, aes(x = points, y = cook)) + geom_point() + geom_text(aes(label = cook_labels), nudge_y = 0.005)
cookplot
```

This has improved the model. Although the correlation coefficient doesn't necessarily indicate a strong positive correlation, there is an association between rebounds and wins at a team level.

```{r ggplot rebwin2}
rebwin2 <- ggplot(T3stattt, aes(x = TRB, y = W )) + geom_point(colour = "#340c85") + geom_smooth(method = "lm", colour = "#850c20") + labs(title = "Relationship Team Wins to Rebounds 2018/2019", subtitle = "Outliers removed", caption = "Data source: basketball-reference.com", x = "Total Rebounds", y = "Number Wins") + geom_text(aes(label = Team))
rebwin2
```
### In Depth: Effective Field Goal Percentage (eFG%)

$eFG percentage = \displaystyle \frac{2FG + (1.5*3FG)}{FGA}$

Effective field goal percentage is an important player metric, however not all players should be selected based on this metric alone, because it is only an offensive metric. It is suggested that an effective field goal percentage above 50% is desirable, and yet there are certain player positions who were more likely to have higher effective field goal percentages than others in 2018/2019. Because there is confounding evidence detailing the importance of this metric for each position, this is briefly explored below. Effective field goal percentage is also not calculated accounting for minutes played. Rather it is calculated based on a number of attempts, which could be influenced by time on court. Note that six players played in two different positions for different teams. These players were left in their own category for this exploratory analysis so as not to skew the data, because their overall effective goal percentage accounts for their stats playing across both positions.

```{r boxplot eFG by pos1, echo=TRUE}
efgpos <- Pstat1819max %>% ggplot(aes(x = Pos, y = eFG., colour = Pos)) + geom_boxplot() + labs(title = "Relevance of Effective Field Goal Percentage by Position", caption = "Data source: basketball-reference.com", x = "Position", y = "Effective Field Goal Percentage", colour = "Position") + theme(plot.title = element_text(hjust = 0.5)) + scale_y_continuous(limits = c(0,1))
efgpos
```

This exploratory plot shows that centres, power forwards and small forwards have higher median EFG%. As mentioned earlier, this is likely due to their position on the court. 

![Basketball Court](images\basketball_court.gif)


There is one outlier power forward with a 100% EFG%. This player may be skewing the data. Zhou Qi only played for 1 minute during 1 game during the season, scoring two points total. It would be a very bold move to roster this player over others who have had more game time. This player can be excluded from analysis for the time being.

There are also many players who have an EFG% of less than 55%, which is the target effective field goal percentage for the team, so players who achieve less than this will not be considered for the starting line up. After filtering these players out, this also only leaves one player to consider who has played two positions. 

```{r remove outliers and below 0.55, echo=TRUE}
Pstat1819max <- filter(Pstat1819max, eFG. < 1.0)
Pstat1819max <- filter(Pstat1819max, eFG. > 0.55)
```

```{r boxplot eFG by pos, echo=TRUE}
efgpos <- Pstat1819max %>% ggplot(aes(x = Pos, y = eFG., colour = Pos)) + geom_boxplot() + labs(title = "Relevance of Effective Field Goal Percentage by Position", subtitle = "Minimum EFG% 55%", caption = "Data source: basketball-reference.com", x = "Position", y = "Effective Field Goal Percentage", colour = "Position") + theme(plot.title = element_text(hjust = 0.5)) + scale_y_continuous(limits = c(0,1))
efgpos
```

The centres, power forwards and small forwards have a median effective goal percentage above 50%, so this metric will be used to select players in those positions.


### Step 6: Player Requirements per Position

Some specific player metrics relevant to each position will be considered in selection [@9@12]. Metrics will be considered per minutes played, as not all players played an equal number of games through the season and not all players played for an equal amount of time.

#### C = centre 
The centre will be selected based on effective field goal percentage and total rebounds per minutes played.
#### SF = small forward
The small forward will be selected based on effective field goal percentage, total rebounds per minutes played and assist to turnovers ratio 
#### PG = point guard
The point guard will be selected on assists to turnovers ratio and three pointers per minutes played (and effective field goal percentage)
#### SG = shooting guard
The shooting guard will be selected based on effective field goal percentage and three-pointers per minutes played
#### PF = power forward
The power forward will be selected based on total rebounds per minutes played and effective goal percentage 

### Step 7: Creating new metrics per minutes played

New variables will need to be calculated for each player per minutes played: total rebounds per minutes played, assists per minutes played, assist to turnovers ratio and three pointers per minutes played.

```{r variables per min , echo=TRUE}
Pstat1819max <- Pstat1819max %>% mutate(rebounds_min = TRB / MP, assists_min = AST / MP, X3P_min = X3P / MP, AST_TOV = AST / TOV)
```

### Step 8: Player Selection 

####Shooting Guard

There are 22 shooting guards to consider based on effective field goal percentage >55%, and three pointers per minutes played.

```{r filter out SG, echo=TRUE}
shootguard <- filter(Pstat1819max, Pos == "SG" | Pos == "SG-PF")
knitr::kable(print(shootguard))
```

There are some shooting guards in this list that have had very few to no game starts in the past season, so these players won't be considered for our starting line up.

```{r filter SG, echo=TRUE}
shootguard <- filter(shootguard, GS > 10)
```

This leaves thirteen players for consideration. In order of best three-point scorers:

```{r SG three point, echo=TRUE}
shootguardtopstart <- shootguard %>% summarise(player_name, X3P_min) %>% arrange(desc(X3P_min))
knitr::kable(print(shootguardtopstart))
```


The players with the highest number of rebounds per minute are:

```{r SG rebounds, echo=TRUE}
shootguardrebstart <- shootguard %>% summarise(player_name, rebounds_min) %>% arrange(desc(rebounds_min))
knitr::kable(print(shootguardrebstart))
```


The players with the lowest salary are: 

```{r how much SG, echo=TRUE}
shootguardtopstartusd <- shootguard %>% summarise(player_name, salary) %>% arrange(desc(salary))
knitr::kable(print(tail(shootguardtopstartusd)))
```

Buddy Hield appears to be an efficient player and an economical choice asking $3 833 760, with lots of game start experience, effective field goal percentage 56%, capability of scoring a high number of three-pointers per minute and has a relatively high number of rebounds per minute.

```{r buddy, echo=TRUE}
buddy <- shootguard %>% filter(player_name == "Buddy Hield")
knitr::kable(print(buddy))
```


#### Small Forward

There are 21 small forwards to select from with EFG% > 55%

```{r small forward, echo=TRUE}
smallforward <- filter(Pstat1819max, Pos == "SF")
str(smallforward)
```

Again, game start experience will be taken into account, so players with fewer than 10 game starts will not be considered

```{r over 10 games, echo=TRUE}
smallforward <- filter(smallforward, GS > 10)
```

This leaves 12 players to choose from. The players with the highest number of rebounds per minute are:

```{r SF high rebound min, echo=TRUE}
smallforwardreb <- smallforward %>% summarise(player_name, rebounds_min) %>% arrange(desc(rebounds_min))
knitr::kable(print(smallforwardreb))
```

The players with the highest assist to turnover ratios are:

```{r SF high asttov, echo=TRUE}
smallforwardasttov <- smallforward %>% summarise(player_name, AST_TOV) %>% arrange(desc(AST_TOV))
knitr::kable(print(smallforwardasttov))
```


The most affordable small forwards are:

```{r afford SF, echo=TRUE}
smallforwardusd <- smallforward %>% summarise(player_name, salary) %>% arrange(desc(salary))
knitr::kable(tail(smallforwardusd))
```

Unfortuantely, LeBron James is too expensive considering our budget, worth over 35 million (more than 25% of the whole team's budget), however Kyle ($8 641 000) makes the top five for rebounds per minute, assists to turnovers and affordability. His effective field goal percentage is 56%, which is equivalent to LeBron's EFG%. Kyle is therefore recommended

```{r kyle, echo=TRUE}
kyle <- smallforward %>% filter(player_name == "Kyle Anderson")
knitr::kable(print(kyle))
```

### Point Guard

There are only 13 point guards with an effective field goal percentage over 56%, which does make sense given their position on the court, however the strongest starting line up is required, so again, players with fewer than 10 game starts will be excluded.

```{r filter PG, echo=TRUE}
pointguard <- filter(Pstat1819max, Pos == "PG" & GS > 10)
knitr::kable(pointguard)
```

This leaves four choices- Ben Simmons, DJ Augustin, Kyrie Irving and Stephen Curry.

In terms of assists to turnovers these players are ranked accordingly:

```{r asttov PG, echo=TRUE}
pointguardasttov <- pointguard %>% summarise(player_name, AST_TOV) %>% arrange(desc(AST_TOV))
knitr::kable(print(pointguardasttov))
```

Ranking by three-pointers per minute;

```{r 3p min PG, echo=TRUE}
pointguard3p <- pointguard %>% summarise(player_name, X3P_min) %>% arrange(desc(X3P_min))
knitr::kable(print(pointguard3p))
```

In terms of salary;
```{r sal PG, echo=TRUE}
pointguardusd <- pointguard %>% summarise(player_name, salary) %>% arrange(desc(salary))
knitr::kable(print(pointguardusd))
```

DJ Augustin is the most affordable ($7 250 000) player with high EFG% (56%), high assists to turnovers and a high number of three-pointers per minutes played

```{r dja, echo=TRUE}
dj <- pointguard %>% filter(player_name == "DJ Augustin")
knitr::kable(print(dj))
```


### Power Forward

As with other positions, for selection of power forward, experience starting games will also be considered. This leaves 16 power forwards to consider.

```{r filter PF, echo=TRUE}
powerforward <- filter(Pstat1819max, Pos == "PF" | Pos == "SG-PF") 
powerforward <- filter(powerforward, GS > 10)
knitr::kable(print(powerforward))
```

Effective goal percentage is one of the most important metrics for power forwards, and is also more strongly correlated to winning, so the current selection will be refined accordingly.

```{r PF efg, echo=TRUE}
powerforwardefg <- powerforward %>% summarise(player_name, eFG.) %>% arrange(desc(eFG.))
knitr::kable(print(powerforwardefg))
```

Rebounds per minute is also a key metric for power forwards:

```{r PF rebounds, echo=TRUE}
powerforwardreb <- powerforward %>% summarise(player_name, rebounds_min) %>% arrange(desc(rebounds_min))
knitr::kable(print(powerforwardreb))
```

Power forwards salaries

```{r power forward salary, echo=TRUE }
powerforwardusd <- powerforward %>% summarise(player_name, salary) %>% arrange(desc(salary))
knitr::kable(tail(powerforwardusd))
```

John Collins is one of the top three players listed for both rebounds per minute and effective goal percentage, following just behind Giannis Antetokounmpo (salary $24 157 304). John's salary is just $2 299 080. John collins is therefore recommended as the more economical power forward of choice.

```{r john, echo=TRUE}
john <- powerforward %>% filter(player_name == "John Collins")
knitr::kable(print(john))
```

### Centre

There are 34 centres who have had more than 10 game starts. There are many experienced and skillful players to choose from.

```{r filter centres, echo=TRUE}
Centres <- filter(Pstat1819max, Pos == "C" & GS > 10)
knitr::kable(print(Centres))
```

Centres have a much higher median effective field goal percentage than other positions. Here are the current players ranked by EFG%:

```{r C efg, echo=TRUE}
centreefg <- Centres %>% summarise(player_name, eFG.) %>% arrange(desc(eFG.))
knitr::kable(print(centreefg))
```

Here are the current players ranked by rebounds per minute:

```{r C high rebound min, echo=TRUE}
centrereb <- Centres %>% summarise(player_name, rebounds_min) %>% arrange(desc(rebounds_min))
knitr::kable(print(centrereb))
```

It is noted that Rudy Gobert performs very strongly in both areas. He is worth $23 491 573, but may be worth the investment if within budget.

```{r rudy, echo=TRUE}
rudy <- Centres %>% filter(player_name == "Rudy Gobert")
knitr::kable(print(rudy))
```

After accounting for the salaries of Kyle Anderson, DJ Augustin, John Collins and Buddy Hield, there is $95976160 remaining for 11 players, including a starting centre. 

```{r remaining budget, echo=TRUE}
fourpos <- 118000000 - 8641000 - 7250000 - 3833760 - 2299080
fourpos
```

The median salary for all players with EFG% > 55% is $2 727 400 and mean is $7 098 873. If Rudy Gobert was rostered, the remaining budget will be $72 484 587 for 10 players, which would be adequate to form a full roster. 

```{r remaining rudy, echo=TRUE}
median <- median(Pstat1819max$salary)
median
mean <- mean(Pstat1819max$salary)
mean
remaining <- 95976160 - 23491573
remaining
```

It is recommended that Rudy Gobert be rostered.



### Final Line Up


Rudy Gobert, Centre
Salary: $23 491 573
Age: 26
EFG% 66%
Rebounds per min: 0.4

[Rudy Gobert](rudygobert.png)

Kyle Anderson, Small Forward
Salary: $8 641 000
Age: 25
EFG%: 56%
Assist to turnovers: 2.21

[Kyle Anderson](images\kyleanderson.png)

DJ Augustin, Point Guard
Salary: $7 250 000
Age 31
EFG%: 56%
Assists to turnovers: 3.33
Three-pointers per minute: 0.05
[DJ Augustin](djaugustin.png)

Buddy Hield, Shooting Guard
Salary: $3 833 760
Age: 26
EFG%: 56%
Rebounds per minute: 0.16
Three-pointers per minute: 0.11
[Buddy Hield](images\buddyhield.png)

John Collins, Power Forward
Salary: $2 299 080
EFG% 59%
Age: 21
Rebounds per minute: 0.33
[John Collins](images\johncollins.png)


### Step 9: Team Statistics for First Five

Firstly, the format required for the 'Advanced Basketball Stats' functions [@4] will be verified, as this will be used to calculate team stats for the proposed starting five.

```{r advbasketballstats format, echo=TRUE}
df1 <- data.frame("name" = c("LeBron James","Team"), "G" = c(67,0),
"GS" = c(62,0), "MP" = c(2316,0),"FG" = c(643,0), "FGA" = c(1303,0),
"Percentage FG" = c(0.493,0), "3P" = c(148,0), "3PA" = c(425,0),
"Percentage 3P" = c(0.348,0), "2P" = c(495,0), "2PA" = c(878,0),
"Percentage 2P" = c(0.564,0),"FT" = c(264,0), "FTA FG" = c(381,0),
"Percentage FT" = c(0.693,0), "ORB" = c(66,0),"DRB" = c(459,0),
"TRB" = c(525,0), "AST" = c(684,0), "STL" = c(78,0),
"BLK" = c(36,0),"TOV" = c(261,0), "PF" = c(118,0),
"PTS" = c(1698,0), "+/-" = c(0,0))
view(df1)
```

Here is the new "Team A" data with the correctly named variables

```{r teama new structure, echo=TRUE}
team <- Pstat1819max %>% filter(player_name == "Rudy Gobert" | player_name == "Kyle Anderson" | player_name == "DJ Augustin" | player_name == "Buddy Hield" | player_name == "John Collins")
team <- team %>% rename(name = player_name, Percentage.FG = FG.,Percentage.3P = X3P., Percentage.2P = X2P., FTA.FG = FTA, Percentage.FT = FT.)
teama <- team %>% select(name, G, GS, MP, FG, FGA, Percentage.FG, X3P, X3PA, Percentage.3P, X2P, X2PA, Percentage.2P, FT, FTA.FG, Percentage.FT, ORB, DRB, TRB, AST, STL, BLK, TOV, PF, PTS)
X... <- c(0, 0, 0, 0, 0)
teama <- teama %>% cbind(X...) %>% rename(X... = ...26)
team_stats(teama)
knitr::kable(print(teama))
```

We can compare to Milwaukee's players with EFG% above 56% and game starts higher than 10. No Milwaukee Point Guard met this criteria, so in order to make a fair comparison, the Milwaukee players with the highest number of game starts (the most likely starting lineup) will be compared to the proposed starting lineup.

```{r MIL team, echo=TRUE}
Milwaukee <- Pstat1819max %>% filter(Tm == "MIL" & GS > 10)
print(Milwaukee)
Milwaukee <- Pstat1819 %>% filter(Tm =="MIL") %>% slice_max(GS, n = 5)
knitr::kable(print(Milwaukee))
```


```{r}
teamb <- Milwaukee %>% rename(name = player_name, Percentage.FG = FG.,Percentage.3P = X3P., Percentage.2P = X2P., FTA.FG = FTA, Percentage.FT = FT.)
teamb <- teamb %>% select(name, G, GS, MP, FG, FGA, Percentage.FG, X3P, X3PA, Percentage.3P, X2P, X2PA, Percentage.2P, FT, FTA.FG, Percentage.FT, ORB, DRB, TRB, AST, STL, BLK, TOV, PF, PTS)
X... <- c(0, 0, 0, 0, 0)
teamb <- teamb %>% cbind(X...)
team_stats(teamb)
knitr::kable(print(teamb))
```


#### Step 10: Comparison of New Team to Milwaukee starting lineup.

```{r compare teamss, echo=TRUE}
teambb <- team_stats(teamb)
teamaa <- team_stats(teama)
outcome <- team_advanced_stats(teamaa, teambb, 48)
knitr::kable(print(outcome))
```
The line up selected for Team A (the new team) playing against Milwaukee (for 48 minutes) would potentially produce these outcome stats.

The 2018/2019 Team Statistics (per game for the season) are printed below for comparison. Of particular note are EFG%, offensive rating, defensive rating, pace. Of course it should be noted that these are the stats for the starting line up of the new team only and these would change as players were subbed in and out. Of course one game's statistics would not be a fair measure of the whole season's performance. However this line up should be capable of beating the top team.

```{r team stat table}
knitr::kable(print(T1stat1819))
```


### Discussion 

  For this analysis, there is no match data available, which would have provided greater insight into how each point was set up to be scored, and better understanding of effective player requirements. It would be worthwhile examining team and player performances at home games as opposed to away games, as home games may positively influence home team scoring Players might perform differently against different opponents who are more skilled, or where team dynamics differ [@14].

  Individual win/loss percentage can be a useful metric for players and whilst we can calculate this for teams based on the available data, we cannot calculate this metric for the players [@11]

  Additionally, players are selected as a starting five, but it is not known whether these players perform consistently well through the whole game and in each game they play. It is also not possible to calculate player statistics per possession [@4] as this would require game data and data from the opposing team, as well as further detail regarding "plus-minuses" or time on and off the court.  
  
  Team dynamics are important to consider and in this case, no existing Chicago players were selected for the new starting five. Whilst this relationship is not simply an increased familiarity = increased performance relationship, five players who have not played together in the previous season may not perform as well on paper[@15]
  
  Potential to roster developing talent is also not taken into account, as no information regarding number of seasons played for each player is available. It is also not known whether certain players improved or declined in performance over the course of the season, demonstrating they may be more or less valuable players. In this case of prioritizing a starting five, experienced starting players were chosen foremost.
  
Player metrics such as injuries and availability [@16], jump height, physical height and speed [@9] are also not accounted for in this analysis and these may be considered as advantageous for performance. Fouls and defensive statistics are also not accounted for. 

  As a final note, the analyst in this situation is also much more familiar with aesthetic sports, thus the rationale behind some of these metrics and choices may be unusual. 


![Go The Bulls!](images\BennyTheBull.png)

### References


